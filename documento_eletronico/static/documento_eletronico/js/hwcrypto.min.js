/*! This is hwcrypto.js 0.0.10 generated on 2015-04-17 */
/* DO NOT EDIT (use src/hwcrypto.js) */
var hwcrypto=function(){"use strict";function a(a){return navigator.mimeTypes&&a in navigator.mimeTypes?!0:!1}function b(a){return"function"==typeof window[a]?!0:!1}function c(a){if("string"==typeof a){for(var b=Math.floor(a.length/2),c=new Uint8Array(b),d=0;b>d;d++)c[d]=parseInt(a.substr(2*d,2),16);return c}}function d(a){for(var b="",c=0;c<a.length;c++)b+=(a[c]<16?"0":"")+a[c].toString(16);return b.toLowerCase()}function e(a){return"hwc"+a.replace("/","").replace("-","")}function f(a){var b=e(a);if(document.getElementById(b))return m("Plugin element already loaded"),document.getElementById(b);m("Loading plugin for "+a+" into "+b);var c='<object id="'+b+'" type="'+a+'" style="width: 1px; height: 1px; position: absolute; visibility: hidden;"></object>',d=document.createElement("div");return d.setAttribute("id","pluginLocation"+b),document.body.appendChild(d),document.getElementById("pluginLocation"+b).innerHTML=c,document.getElementById(b)}function g(){var c="probe() detected ";b(o)&&m(c+o),a(n)&&m(c+n)}function h(){function a(a){switch(m("Error: "+a+" with: "+c.errorMessage),parseInt(a)){case 1:return p;case 2:return r;case 17:return r;case 19:return u;default:return m("Unknown error: "+a+" with: "+c.errorMessage),s}}function b(b){return new Error(a(b))}this._name="NPAPI/BHO for application/x-digidoc";var c=f(n),d={};this.check=function(){return new Promise(function(a){setTimeout(function(){a("undefined"!=typeof c.version)},0)})},this.getVersion=function(){return new Promise(function(a){var b=c.version;a(b)})},this.getCertificate=function(a){return a&&a.lang&&(c.pluginLanguage=a.lang),new Promise(function(a,e){try{var f=c.getCertificate();0!==parseInt(c.errorCode)?e(b(c.errorCode)):(d[f.cert]=f.id,a({hex:f.cert}))}catch(g){m(g),e(b(c.errorCode))}})},this.sign=function(a,e,f){return new Promise(function(g,h){var i=d[a.hex];if(i)try{var j=f.lang||"en",k=c.sign(i,e.hex,j);g({hex:k})}catch(l){m(JSON.stringify(l)),h(b(c.errorCode))}else m("invalid certificate: "+a),h(new Error(r))})}}function i(){this._name="Chrome native messaging extension";var a=null;this.check=function(){return new Promise(function(c){return b(o)?(a=new window[o],void c(a?!0:!1)):c(!1)})},this.getVersion=function(){return a.getVersion()},this.getCertificate=function(b){return a.getCertificate(b)},this.sign=function(b,c,d){return a.sign(b,c,d)}}function j(){this._name="No implementation",this.check=function(){return new Promise(function(a){a(!0)})},this.getVersion=function(){return Promise.reject(new Error(t))},this.getCertificate=function(){return Promise.reject(new Error(t))},this.sign=function(){return Promise.reject(new Error(t))}}function k(a){return new Promise(function(b){var c=new a;c.check().then(function(a){a?(m("Using backend: "+c._name),v=c,b(!0)):(m(c._name+" check() failed"),b(!1))})})}function l(c){return new Promise(function(d){function e(){k(h).then(function(a){d(a?!0:k(j))})}return m("Autodetecting best backend"),"undefined"==typeof c&&(c=!1),null===v||c?-1!=navigator.userAgent.indexOf("MSIE")||-1!=navigator.userAgent.indexOf("Trident")?(m("Assuming IE BHO, testing"),e()):-1!=navigator.userAgent.indexOf("Chrome")&&b(o)?void k(i).then(function(a){a?d(!0):e()}):a(n)?e():void d(k(j)):d(!0)})}var m=function(){};m("hwcrypto.js activated"),window.addEventListener=window.addEventListener||window.attachEvent;var n="application/x-digidoc",o="TokenSigning",p="user_cancel",q="no_certificates",r="invalid_argument",s="technical_error",t="no_implementation",u="not_allowed";window.addEventListener("load",function(){g()});var v=null,w={};return w.use=function(a){return new Promise(function(b){"undefined"==typeof a||"auto"===a?l().then(function(a){b(a)}):b("chrome"===a?k(i):"npapi"===a?k(h):!1)})},w.debug=function(){return new Promise(function(a){var b="hwcrypto.js 0.0.10";l().then(function(){v.getVersion().then(function(c){a(b+" with "+v._name+" "+c)},function(){a(b+" with failing backend "+v._name)})})})},w.getCertificate=function(a){return"object"!=typeof a?(m("getCertificate options parameter must be an object"),Promise.reject(new Error(r))):(a&&!a.lang&&(a.lang="en"),l().then(function(){return"https:"!==location.protocol&&"file:"!==location.protocol?Promise.reject(new Error(u)):v.getCertificate(a).then(function(a){return a.hex&&!a.encoded&&(a.encoded=c(a.hex)),a})}))},w.sign=function(a,b,e){return arguments.length<2?Promise.reject(new Error(r)):(e&&!e.lang&&(e.lang="en"),b.type&&(b.value||b.hex)?(b.hex&&!b.value&&(m("DEPRECATED: hash.hex as argument to sign() is deprecated, use hash.value instead"),b.value=c(b.hex)),b.value&&!b.hex&&(b.hex=d(b.value)),l().then(function(){return"https:"!==location.protocol&&"file:"!==location.protocol?Promise.reject(new Error(u)):v.sign(a,b,e).then(function(a){return a.hex&&!a.value&&(a.value=c(a.hex)),a})})):Promise.reject(new Error(r)))},w.NO_IMPLEMENTATION=t,w.USER_CANCEL=p,w.NOT_ALLOWED=u,w.NO_CERTIFICATES=q,w.TECHNICAL_ERROR=s,w.INVALID_ARGUMENT=r,w}();