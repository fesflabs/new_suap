# -*- coding: utf-8 -*-

from djtools.management.commands import BaseCommandPlus
import json
from rh.models import PessoaFisica
import base64


class Command(BaseCommandPlus):
    def handle(self, *args, **options):
        # == BACKUP == #
        # pks = [273517, 211247, 156733, 273388, 133363, 132279, 57775, 211252, 191541, 216486, 199319, 270800, 221081, 194727, 222651, 210774, 132128, 212707, 164051, 133880, 191556, 217706, 163418, 285826, 166859, 187927, 183866, 188827, 233353, 134314, 175247, 214216, 214937, 1179, 164041, 185171, 229670, 108133, 165763, 234633, 188276, 210906, 188480, 160879, 193755, 33474, 191240, 211355, 258550, 271099, 220979, 273376, 183682, 165424, 236834, 216523, 190047, 211327, 235680, 163693, 269840, 210579, 217520, 233277, 189225, 304472, 193825, 235030, 214331, 165422, 111934, 239418, 242496, 152558, 191388, 212113, 276776, 137710, 288054, 168068, 190491, 16885, 211156, 270491, 221402, 195019, 167693, 249987, 269976, 124527, 132370, 270779, 210465, 212233, 167365, 141335, 212627, 280871, 132583, 210772, 224705, 218606, 277380, 133500, 140308, 134683, 280875, 137242, 179978, 188451, 233649, 188832, 195010, 131787, 211619, 237076, 188510, 272117, 210254, 215269, 188495, 234923, 239511, 187957, 235682, 205067, 211956, 188190, 214665, 234369, 214814, 214046, 4558, 115375, 242494, 280881, 258634, 270545, 270077, 229898, 233827, 214986, 285819, 214737, 187167, 189854, 27448, 165261, 271293, 210839, 192558, 212091, 166769, 215042, 188333, 191847, 132927, 187646, 133197, 134727, 212926, 169596, 219653, 7603, 188228, 213329, 270540, 251526, 214781, 189750, 195044, 48806, 167615, 233691, 258099, 197881, 165848, 275277, 188334, 163536, 239747, 321414, 194116, 31338, 288857, 216241, 216635, 164082, 13707, 210983, 33826, 188224, 127762, 163773, 216179, 302714, 113047, 222479, 230363, 276396, 304844, 302996, 188317, 9932, 201508, 269933, 9284, 188982, 233262, 133621, 304386, 305850, 202599, 137091, 249341, 238061, 194896, 114667, 242663, 304684, 189747, 280903, 164083, 940, 214450, 191493, 211452, 234567, 86250, 214742, 165986, 254807, 292072, 20266, 132395, 193778, 166773, 211663, 269726, 211028, 85035, 217426, 287095, 213089, 191009, 197414, 165417, 133404, 166258, 114170, 214402, 233381, 214896, 167386, 212596, 165447, 216309, 271312, 131835, 235052, 188412, 211476, 220938, 216109, 169800, 134786, 239126, 214770, 163700, 113851, 270207, 188052, 234218, 284935, 275012, 222662, 215663, 212465, 211771, 521, 175244, 183728, 202600, 241266, 195469, 191725, 238783, 165502, 217990, 133576, 270479, 191089, 163754, 244063, 188400, 210762, 305037, 193917, 153263, 210754, 188053, 28768, 108166, 191181, 273358, 194528, 16170, 26703, 174586, 210259, 237710, 251410, 188332, 235531, 270752, 304545, 215907, 271496, 194118, 214209, 269338, 114486, 199997, 215050, 287433, 167255, 214752, 188237, 127831, 222742, 174043, 29079, 142704, 168209, 1190, 212555, 216255, 216435, 171621, 236612, 224769, 187649, 154784, 242495, 166241, 304867, 57545, 192379, 192420, 216376, 183605, 222793, 186876, 274912, 131896, 301594, 274330, 192980, 188044, 242655, 239487, 132471, 275198, 239318, 237717, 322170, 196984, 152491, 78879, 304200, 215551, 264226, 276213, 111582, 269507, 194743, 214747, 165452, 109209, 215436, 210888, 165467, 169237, 133382, 286017, 187817, 54390, 188424, 174845, 268903, 161798, 234238, 190592, 234912, 301418, 272767, 258033, 191983, 174607, 111498, 234020, 154124, 182646, 189007, 133913, 235529, 320130, 187650, 272330, 239253, 164400, 188428, 235165, 213041, 134648, 234478, 189186, 236087, 15227, 112374, 268904, 210894, 4080, 211464, 214828, 215297, 87372, 283690, 137711, 272968, 268970, 242879, 222669, 236915, 167845, 28798, 172451, 233162, 2553, 134551, 218232, 216405, 115851, 616, 213369, 203526, 194844, 134728, 237919, 157525, 150180, 197343, 191352, 215364, 211284, 193353, 276710, 139507, 212787, 193951, 283911, 190344, 274266, 131834, 234403, 191114, 687, 219601, 214327, 211211, 217322, 314905, 200174, 173525, 170250, 195465, 212122, 195245, 249348, 638, 234537, 137196, 210248, 281339, 271504, 92437, 198856, 189996, 235134, 133575, 166548, 111978, 165822, 269347, 305089, 236153, 302303, 196085, 137037, 186875, 210855, 157068, 199383, 217188, 133934, 122053, 108291, 212427, 237692, 196851, 140621, 190529, 288396, 233364, 191100, 206533, 163389, 215845, 202551, 164032, 111638, 165635, 238732, 217459, 167644, 221959, 164128, 162284, 283991, 288346, 2592, 270531, 1056, 223189, 165371, 216840, 210866, 213340, 211984, 167842, 167794, 48327, 241004, 166660, 229280, 216812, 222865, 216207, 215930, 192089, 271515, 188326, 1885, 210214, 234621, 97652, 165531, 190749, 196906, 222311, 237715, 233085, 213678, 194167, 216774, 193589, 196948, 131899, 189926, 220445, 184458, 275000, 272737, 200459, 274894, 213238, 305068, 214202, 310086, 167382, 132282, 109179, 193069, 238955, 308566, 127561, 936, 286013, 182961, 229571, 182887, 211077, 148323, 188816, 247741, 216899, 214753, 274868, 239186, 239223, 29478, 112472, 164065, 281381, 132823, 175053, 289439, 194099, 193802, 239753, 38786, 167946, 136063, 255026, 881, 270976, 175714, 136667, 191241, 174883, 194350, 188840, 188196, 200902, 15102, 192398, 139574, 195598, 53095, 233921, 210297, 191759, 187729, 233476, 189148, 275244, 214071, 251306, 211359, 275852, 269831, 219665, 233326, 242889, 202762, 212630, 212638, 211336, 268711, 210918, 304492, 108495, 148016, 272326, 214294, 273013, 192240, 214524, 234351, 190930, 234306, 252563, 167203, 211647, 188822, 110733, 309569, 238355, 133518, 197660, 164087, 214448, 168747, 275327, 274311, 90664, 103175, 174998, 162861, 215614, 218936, 174864, 165462, 166797, 187691, 191003, 234526, 220465, 216372, 188455, 236554, 212199, 191065, 133857, 164117, 250761, 137204, 215964, 210492, 163683, 232883, 237670, 155311, 164493, 241292, 165976, 238359, 214345, 240286, 234924, 115633, 199314, 213763, 131983, 212798, 233695, 164093, 210466, 112360, 163714, 187892, 211369, 164898, 210740, 210853, 211610, 214042, 270526, 234251, 237470, 216346, 213363, 233238, 201387, 211576, 259865, 176242, 241816, 199129, 188059, 234956, 165653, 258283, 303287, 221418, 134696, 97660, 215401, 216118, 108119, 209875, 190462, 211623, 212647, 134262, 131942, 271860, 210763, 213366, 214926, 251826, 4399, 254342, 134264, 185025, 168378, 192112, 195027, 201831, 222454, 221580, 200620, 210852, 140024, 515, 96193, 166266, 210695, 198947, 164478, 172731, 240060, 220970, 236189, 221386, 166874, 191781, 138901, 189265, 136112, 234766, 28576, 212516, 215973, 133891, 236445, 215847, 237601, 203715, 214107, 213488, 166187, 210831, 283631, 213033, 161902, 164067, 134785, 140636, 108508, 217791, 100786, 235066, 164059, 186865, 199310, 189855, 194523, 38086, 164899, 302842, 235698, 214329, 154869, 53000, 45002, 188978, 232990, 133176, 191510, 214988, 192521, 194353, 194583, 47743, 133450, 211304, 238835, 190225, 238367, 134298, 215522, 165575, 193771, 215077, 203638, 149169, 167152, 269004, 109337, 163323, 164645, 134017, 144273, 192363, 168968, 276783, 269077, 232581, 210751, 191473, 275077, 175323, 138681, 163156, 235864, 229485, 239298, 195075, 111661, 303771, 257667, 29779, 190752, 187935, 163679, 194755, 198875, 194573, 304138, 216007, 212264, 238062, 124719, 211535, 304465, 213172, 215102, 240984, 199804, 283044, 269724, 165435, 217321, 275524, 212294, 192364, 229458, 16951, 274989, 233501, 167446, 175133, 74338, 132826, 191893, 89668, 218797, 275169, 187708, 211345, 210995, 165574, 163578, 250263, 132967, 169959, 233155, 212636, 210574, 189413, 188087, 199683, 216009, 258464, 274799, 230060, 259523, 213107, 200380, 233064, 308356, 255121, 216548, 206460, 216267, 191892, 182953, 167635, 192389, 137159, 161096, 134253, 132761, 133881, 252224, 214324, 184545, 239208, 211488, 269555, 211899, 302896, 187929, 241003, 136777, 233091, 255557, 165266, 17902, 248615, 193832, 273217, 134144, 133146, 132643, 303264, 272575, 281223, 268858, 172196, 304895, 216858, 233125, 41607, 259061, 213373, 218591, 190331, 13747, 217776, 118868, 222922, 210407, 272403, 308082, 132779, 165565, 233703, 216937, 190347, 266851, 189140, 216117, 219431, 275279, 159331, 301844, 191087, 163844, 290430, 131999, 191277, 231995, 284081, 189474, 239275, 228930, 239776, 188797, 237130, 134019, 214980, 259920, 210235, 168210, 188687, 216150, 185082, 270660, 301353, 217051, 188787, 108750, 194447, 164404, 233630, 192578, 290265, 298918, 302285, 211127, 251394, 96749, 232952, 200102, 305091, 17703, 188788, 174612, 168295, 161858, 174949, 194359, 280605, 210870, 235089, 216370, 174945, 195174, 194322, 191701, 28076, 223032, 88230, 143113, 190777, 241162, 234741, 125581, 190369, 163615, 239294, 211324, 236578, 238353, 224007, 132069, 192790, 199019, 154870, 302418, 184117, 131927, 233658, 260064, 196845, 189391, 239938, 238802, 159798, 167801, 210954, 136786, 272301, 189280, 200969, 163401, 131713, 199385, 211730, 214885, 96482, 195226, 233318, 191894, 199124, 272018, 194589, 233869, 210264, 132513, 165582, 214962, 301504, 214078, 212521, 234557, 217767, 191163, 134779, 237163, 166904, 190191, 276787, 234530, 210935, 222442, 108681, 188856, 171108, 215007, 201780, 180029, 172851, 191739, 133723, 189601, 165138, 171558, 301712, 210851, 133292, 322021, 238256, 236480, 214934, 131916, 214754, 301489, 210230, 164009, 132341, 211806, 222905, 133012, 199086, 210904, 188302, 28654, 192577, 212634, 273943, 211325, 215832, 223570, 187885, 200619, 199257, 211400, 167848, 153658, 211482, 233926, 108148, 131922, 165537, 275082, 302729, 199744, 233088, 210606, 283639, 234045, 194789, 188142, 213371, 167817, 165752, 211337, 210843, 195548, 134643, 191925, 195002, 301608, 242064, 167856, 214730, 233195, 133969, 214530, 216760, 100479, 190604, 233029, 132784, 187884, 133248, 212497, 165558, 239053, 131794, 237494, 4383, 248878, 222562, 187196, 281267, 230681, 153659, 233633, 139427, 166243, 210780, 233579, 132367, 165641, 212523, 167722, 233267, 190339, 281272, 235475, 167232, 251387, 138922, 174527, 214779, 281280, 281281, 275134, 131704, 195047, 239108, 270856, 138277, 155268, 128605, 253988, 186943, 210642, 188646, 205817, 283095, 137988, 223458, 194943, 190004, 195244, 250388, 124956, 169216, 219110, 163792, 128662, 132004, 134082, 165973, 166915, 194323, 193595, 303365, 210477, 145907, 109069, 123448, 73818, 679, 241959, 189085, 304847, 239821, 249357, 281408, 286464, 199679, 203249, 233797, 151321, 212911, 234733, 251225, 188267, 187834, 193803, 289385, 194581, 158819, 233953, 163790, 131840, 164287, 213443, 281136, 212499, 282469, 281422, 274727, 249149, 240150, 17315, 184131, 220681, 214338, 233876, 166324, 134267, 106720, 286362, 188297, 195400, 281046, 281109, 274055, 269640, 238769, 212445, 163760, 211137, 201879, 305864, 194121, 212158, 188488, 215145, 165331, 195024, 211913, 211568, 211398, 133878, 188028, 235828, 189503, 210473, 192580, 210481, 139163, 238365, 190343, 132810, 131795, 127170, 274310, 234647, 306952, 275778, 238332, 238364, 214840, 139183, 234601, 289114, 191297, 188843, 147832, 195013, 281129, 200740, 165340, 270999, 211251, 163416, 237021, 197475, 260267, 6803, 114155, 282105, 281948, 133689, 165430, 132844, 191459, 191168, 195239, 169696, 270427, 238304, 237335, 137277, 212738, 211457, 164001, 165240, 134690, 190439, 34832, 237992, 237966, 237075, 189433, 301903, 210423, 210432, 212529, 202145, 190489, 187696, 233535, 153257, 274014, 195716, 155602, 215424, 212611, 289014, 107134, 120544, 131784, 215933, 213299, 215967, 223484, 140360, 189911, 136959, 128791, 99247, 256347, 273447, 239819, 54069, 132198, 134090, 199705, 210940, 234574, 188637, 190692, 188821, 249720, 281010, 216810, 191121, 1954, 132705, 2222, 145022, 164124, 136760, 52833, 215414, 220515, 229492, 211941, 132762, 132627, 306278, 188341, 233556, 212147, 222296, 213844, 29701, 221483, 234914, 229947, 138116, 273519, 283255, 141079, 212151, 163497, 166648, 237561, 308571, 134358, 212642, 159821, 167244, 196856, 182915, 198131, 203675, 222610, 275211, 166672, 165542, 167072, 211597, 269368, 302251, 225675, 189167, 239414, 236355, 188650, 184914, 193933, 212679, 164118, 211397, 285982, 167447, 188685, 48228, 165469, 275769, 188477, 111298, 233700, 234209, 237459, 134645, 303654, 216066, 134133, 214882, 191412, 200341, 211118, 237463, 188638, 272486, 214783, 229573, 175336, 190424, 238505, 194132, 272367, 193770, 215564, 128760, 238306, 290219, 134094, 184625, 165652, 283038, 234298, 191001, 234322, 214036, 304460, 165343, 163652, 128958, 270254, 134565, 214310, 276788, 271849, 133552, 134083, 235881, 286254, 189392, 210857, 165342, 140088, 213276, 220497, 190461, 302447, 165640, 272396, 237783, 28672, 188682, 132076, 188651, 92951, 214922, 191634, 236535, 269659, 164113, 210597, 178400, 188094, 136121, 165863, 173959, 15871, 184899, 140648, 165808, 238778, 138236, 113835, 196987, 283259, 241098, 151867, 195385, 210408, 138290, 188698, 189761, 212164, 234718, 287145, 195256, 167310, 289666, 139705, 175081, 216733, 191940, 241241, 215844, 167859, 54354, 140154, 283491, 165649, 240333, 233814, 165333, 238348, 191630, 210649, 132811, 237700, 272141, 189739, 268794, 214845, 132786, 284070, 15296, 233908, 34441, 136587, 216012, 192921, 238259, 190348, 211117, 163983, 233589, 211164, 270628, 190515, 217197, 202343, 211689, 114062, 173848, 308078, 188134, 236755, 168723, 182706, 197007, 175314, 240965, 166792, 234495, 268846, 213273, 233730, 191217, 29031, 132532, 128460, 191786, 210932, 80772, 223618, 275310, 210991, 165259, 108506, 212167, 189284, 154342, 210786, 188639, 192212, 234257, 194584, 213906, 234324, 355, 192188, 218926, 281299, 192497, 186862, 168387, 191792, 233533, 210600, 210546, 260438, 233222, 202998, 131810, 213258, 166213, 132644, 250050, 193789, 215451, 220444, 219612, 235779, 166852, 188294, 192516, 223255, 222331, 211544, 51288, 222433, 162027, 189799, 210703, 134629, 222654, 188839, 134065, 211725, 144067, 191621, 213821, 187830, 217514, 212908, 214917, 276289, 57862, 139189, 134137, 189429, 233668, 165434, 166537, 212056, 211681, 234348, 214784, 216161, 191785, 165645, 166927, 188253, 190579, 211709, 305186, 233167, 185030, 166292, 186852, 218136, 174114, 235086, 187956, 211946, 214204, 238749, 222312, 223510, 183041, 278653, 182995, 250775, 215342, 211769, 212314, 210324, 188754, 217170, 223052, 259051, 199250, 217164, 184673, 182750, 1977, 304973, 165842, 188275, 264173, 27518, 233917, 1269, 73967, 274769, 167806, 188795, 195007, 258152, 280623, 1980, 92989, 192510, 130390, 189801, 128759, 199252, 273591, 214099, 286002, 259700, 199308, 285210, 167312, 234361, 221080, 132502, 234070, 212400, 194352, 215900, 700, 237707, 274961, 164089, 192016, 6353, 202136, 167819, 187570, 212343, 211311, 281936, 280791, 280792, 121051, 280804, 132339, 216261, 194358, 275398, 193940, 211004, 191784, 188153, 221038, 191586, 249728, 131892, 132669, 210363, 163362, 283598, 194582, 240126, 283997, 193027, 217185, 125641, 194508, 167329, 163549, 167380, 167603, 270521, 213501, 182030, 235971, 187657, 211916, 190917, 168191, 164079, 217054, 199379, 144086, 163580, 211033, 214761, 236428, 131696, 133650, 218837, 1292, 37739, 238741, 191304, 163766, 225075, 11150, 229308, 194135, 229899, 187818, 113695, 134697, 220624, 212357, 292239, 167735, 210948, 194091, 194797, 257267, 213211, 187659, 188476, 132059, 184913, 280818, 251278, 185820, 9056, 111806, 191305, 188654, 190501, 187730, 188413, 211053, 275074, 238545, 218285, 166898, 134104, 210679, 272400, 194794, 245213, 211646, 237446, 213280, 167366, 214698, 195046, 168000, 212950, 198830, 210829, 193343, 216703, 163826, 238548, 216230, 214960, 237375, 191774, 212359, 272980, 245557, 199256, 234700, 164214, 164538, 272632, 199006, 191783, 166793, 218431, 127089, 50723, 163909, 184100, 163371, 285392, 304913, 165345, 164606, 270909, 235636, 131890, 163598, 240924, 132574, 210646, 187965, 233826, 202478, 628, 211432, 138396, 187977, 210849, 213854, 211674, 153054, 234339, 213352, 214049, 199283, 234401, 190848, 171626, 189260, 200622, 174719, 241305, 97494, 169046, 200549]
        # attrs = ['id', 'template']
        #  'nome',
        #  'nome_usual',
        #  'nome_social',
        #  'nome_registro',
        #  'email',
        #  'email_secundario',
        #  'website',
        #  'excluido',
        #  'natureza_juridica',
        #  'sistema_origem',
        #  'cpf',
        #  'sexo',
        #  'grupo_sanguineo',
        #  'fator_rh',
        #  'titulo_numero',
        #  'titulo_zona',
        #  'titulo_secao',
        #  'titulo_uf',
        #  'titulo_data_emissao',
        #  'rg',
        #  'rg_orgao',
        #  'rg_data',
        #  'rg_uf',
        #  'nascimento_municipio_id',
        #  'nascimento_data',
        #  'nome_mae',
        #  'nome_pai',
        #  'foto',
        #  'cnh_carteira',
        #  'cnh_registro',
        #  'cnh_categoria',
        #  'cnh_emissao',
        #  'cnh_uf',
        #  'cnh_validade',
        #  'ctps_numero',
        #  'ctps_uf',
        #  'ctps_data_prim_emprego',
        #  'ctps_serie',
        #  'pis_pasep',
        #  'pagto_banco_id',
        #  'pagto_agencia',
        #  'pagto_ccor',
        #  'pagto_ccor_tipo',
        #  'username',
        #  'tem_digital_fraca',
        #  'senha_ponto',
        #  'data_obito',
        #  'template',
        #  'template_importado_terminal',
        #  'estado_civil_id',
        #  'raca_id',
        #  'nacionalidade',
        #  'pais_origem_id',
        #  'deficiencia_id',
        #  'lattes']
        # qs = PessoaFisica.objects.filter(pk__in=pks).values(*attrs)
        # print(qs.count(), "registros afetados")
        # l = []
        # for dados in qs:
        #     d = {}
        #     for attr in attrs:
        #         d[attr] = dados[attr]
        #         if attr == 'template': d[attr] = d[attr] and base64.b64encode(d[attr]).decode() or None
        #         #if attr in ['titulo_data_emissao', 'rg_data', 'nascimento_data', 'cnh_emissao', 'cnh_validade', 'ctps_data_prim_emprego', 'data_obito']: d[attr] = d[attr] and d[attr].strftime("%d/%m/%Y") or None
        #     l.append(d)
        #
        # open('pessoas_sem_digitais.json', 'w').write(json.dumps(l))

        # == RESTORE == #
        for dados in json.loads(open('pessoas_sem_digitais.json').read()):
            pk = dados.pop('id')
            for attr in dados:
                if attr == 'template':
                    dados[attr] = dados[attr] and base64.b64decode(dados[attr].encode()) or None
                # if attr in ['titulo_data_emissao', 'rg_data', 'nascimento_data', 'cnh_emissao', 'cnh_validade', 'ctps_data_prim_emprego', 'data_obito']: dados[attr] = dados[attr] and datetime.strptime(dados[attr], '%d/%m/%Y').date() or None
            PessoaFisica.objects.filter(pk=pk, template__isnull=True).update(**dados)
