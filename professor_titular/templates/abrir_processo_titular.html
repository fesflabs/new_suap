{% extends super_template %}

{% load professor_titular_tags %}

{% block extrahead %}
<script src="/static/arquivo/js/fileuploader.js"></script>
<script type="text/javascript" src="/static/arquivo/js/compatibility.js"></script>
<script type="text/javascript" src="/static/arquivo/js/pdf.js"></script>
<style>
    .instrucoes_gerais li{
        margin: 0;
    }
</style>

<script type="text/javascript">
    $( document ).ready(function() {
        iniciar_autosalvamento_campos_estaticos();
        $('#recalcular_pontuacao').click(function () {
            if ($(this).attr("disabled") === "disabled")
                return false;
            else
            {
               $(this).attr("disabled", "disabled");
               $(this).html('Aguarde...');
            }
        });
    });

	function iniciar_autosalvamento_campos_estaticos(){
        var ids = [
        	'id_data_concessao_titulacao_doutor',
            'id_data_graduacao_EBTT',
            'id_data_progressaoD404',
            'id_data_avaliacao_desempenho',
            'id_introducao_relatorio_descritivo',
            'itinerario_formacao_txt',
            'atuacao_docente_txt',
            'producao_cademica_txt',
            'prestacao_servicos_txt',
            'atividade_adm_txt',
            'titulos_homenagens_txt',
            'id_conclusao_relatorio_descritivo'
        ];

        $.each(ids, function(index, value) {
            $('#'+value).attr('onchange','Processa_Salvamento(\'Autosalvar\', {{ processo.id }}, \'{{ processo.tipo_rsc }}\', \'Aguardando envio para CPPD\')');
        });
    }

    function onInitTabs(){
        preencher_relatorio_descritivo();
        $("a[data-tab='relatorio_descritivo']").on('click', function(){
            preencher_relatorio_descritivo();
        });

        preencher_quadro_resumo_pontuacao_requerida();
        $("a[data-tab='quadro_resumo_pontuacao_requerida']").on('click', function(){
            preencher_quadro_resumo_pontuacao_requerida();
        });
    }

    function preencher_relatorio_descritivo(){
        $.get("/professor_titular/relatorio_descritivo/{{ processo.id }}/", function(data) {
            $("div[data-tab='relatorio_descritivo']").html(data);
        }).always(function() {
            iniciar_autosalvamento_campos_estaticos();
        });
    }

    function preencher_quadro_resumo_pontuacao_requerida(){
        $.get("/professor_titular/quadro_resumo_pontuacao_requerida/{{ processo.id }}/", function(data) {
            $("div[data-tab='quadro_resumo_pontuacao_requerida']").html(data);
        });
    }

    function human_file_size(bytes, si) {
        var thresh = si ? 1000 : 1024;
        if(bytes < thresh) return bytes + ' B';
        var units = si ? ['kB','MB','GB','TB','PB','EB','ZB','YB'] : ['KB','MB','GB','TB','PB','EB','ZB','YB'];
        var u = -1;
        do {
            bytes /= thresh;
            ++u;
        } while(bytes >= thresh);
        return bytes.toFixed(1)+' '+units[u];
    };

    function calcula_pontuacao_total_grupo(classe_grupo, teto_grupo){
        //alert(teto_grupo);

        var pontuacao_total_grupo = 0;
        $('span.'+classe_grupo).filter('.total_indicador').each(function() {
            var pontuacao_total = parseFloat($(this).html());
            pontuacao_total_grupo += pontuacao_total;
            //alert(pontuacao_total_grupo);
        });

        if(pontuacao_total_grupo > teto_grupo) {
            pontuacao_total_grupo = teto_grupo;

            $('#feedback_message').fadeOut();
            $('#error').attr('class','errornote');
            $('#error').html('A pontuação máxima(teto) neste grupo foi atingida. ');
            $('#error').fadeOut();
            $('#error').fadeIn();
        }

        if(classe_grupo == "A") {
            $("#rsc1").html(pontuacao_total_grupo.toFixed(2));
            $("#rsc1hidden").val(pontuacao_total_grupo.toFixed(2));
        } else if (classe_grupo == "B") {
            $("#rsc2").html(pontuacao_total_grupo.toFixed(2));
            $("#rsc2hidden").val(pontuacao_total_grupo.toFixed(2));
        } else if (classe_grupo == "C") {
            $("#rsc3").html(pontuacao_total_grupo.toFixed(2));
            $("#rsc3hidden").val(pontuacao_total_grupo.toFixed(2));
        }
          else if (classe_grupo == "D") {
            $("#rsc4").html(pontuacao_total_grupo.toFixed(2));
            $("#rsc4hidden").val(pontuacao_total_grupo.toFixed(2));
        } else if (classe_grupo == "E") {
            $("#rsc5").html(pontuacao_total_grupo.toFixed(2));
            $("#rsc5hidden").val(pontuacao_total_grupo.toFixed(2));
        } else if (classe_grupo == "F") {
            $("#rsc6").html(pontuacao_total_grupo.toFixed(2));
            $("#rsc6hidden").val(pontuacao_total_grupo.toFixed(2));
        }else if (classe_grupo == "G") {
            $("#rsc7").html(pontuacao_total_grupo.toFixed(2));
            $("#rsc7hidden").val(pontuacao_total_grupo.toFixed(2));
        }else if (classe_grupo == "H") {
            $("#rsc8").html(pontuacao_total_grupo.toFixed(2));
            $("#rsc8hidden").val(pontuacao_total_grupo.toFixed(2));
        }

        // pontuação requerida (Soma das pontuações dos grupos)
        var total_pontuacao_pretendida = parseFloat($("#rsc1hidden").val()) + parseFloat($("#rsc2hidden").val())
            + parseFloat($("#rsc3hidden").val()) + parseFloat($("#rsc4hidden").val()) + parseFloat($("#rsc5hidden").val())
            + parseFloat($("#rsc6hidden").val()) + parseFloat($("#rsc7hidden").val()) + parseFloat($("#rsc8hidden").val());
        $("#pontuacao_requerida").html(total_pontuacao_pretendida);
    }

    function calcula_pontuacao_total_indicador(id_indicador){
        var pontuacao_total_indicador = 0;
        $(".indicador_class_"+id_indicador).each(function() {
            var pontuacao_criterio = parseFloat($(this).html());
            pontuacao_total_indicador += pontuacao_criterio;
        });
        var obj = $('#total_indicador_'+ id_indicador);
        obj.parent().parent().find('p.alert').remove();
        obj.html(pontuacao_total_indicador.toFixed(2))
    }

    function calcula_pontuacao_total_criterio(id_criterio){
        var pontuacao_total_criterio = 0;
        $(".criterio_class_"+id_criterio).each(function() {
            var pontuacao_criterio = parseFloat($(this).html());
            pontuacao_total_criterio += pontuacao_criterio;
        });
        $('#total_pontos_criterio_'+ id_criterio).html(pontuacao_total_criterio.toFixed(2));
    }

    function calcula_nota_pretendida(field_qtd, arquivo_id, id_indicador, id_grupo, criterio_id, pontos, teto_grupo) {
        nota =  parseFloat(field_qtd.value * pontos).toFixed(2);
        $("span#pontuacao_arquivo_" + arquivo_id).html(nota);
        $("#nota_" + arquivo_id).attr('value', nota);
        var id_pontuacao_arquivo = field_qtd.id.replace('qtd', 'pontuacao_arquivo')
        var classe_grupo = $(field_qtd).parent().parent().find("span#"+id_pontuacao_arquivo).attr("class").split(" ").pop();
        calcula_pontuacao_total_indicador(id_indicador);
        calcula_pontuacao_total_grupo(classe_grupo, teto_grupo);
        calcula_pontuacao_total_criterio(criterio_id);
        Valida_qtds();
    }

    //sendAjax | Função genérica do processamento Ajax + Jquery + Json
    function sendAjax(url, parametros, sucesso, erro) {
        $.ajax({
            type: "POST",
            url: url,
            data: parametros,
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: sucesso,
            error: erro
        });
    }

    function Excluir(id, msg, url, processo_id, documentos_exigidos) {
        var parametros = { "Id": "" };
        parametros.Id = id;
        if (documentos_exigidos==undefined){
            var classes_span = $("#linha-" + id).find('span:last').attr('class').split(' ');
            var criterio_id = classes_span[1].split('_').pop();
            var criterio_span = $('span#total_pontos_criterio_'+criterio_id);

            var indicador_id = classes_span[0].split('_').pop();
            var div_indicador = $('div#'+indicador_id)
        }


        if (confirm(msg)) {
            sendAjax(url, JSON.stringify(parametros), function (retorno) {
                        if (retorno.ok)
                        {
                            $(".linha-" + id).animate({ backgroundColor: "#fbc7c7" }, "slow").animate({ opacity: "hide" }, "slow", function () {
                                $(this).remove();
                                calcula_pontuacao_total_criterio(criterio_id)
                                calcula_pontuacao_total_indicador(indicador_id);
                                calcula_pontuacao_total_grupo(classes_span[2], 100);
                                Salvar_Processo_Titular(processo_id, true);
                                $('#data_referencia_retroatividade').html(retorno.data_referencia_retroatividade);
                            })
                        } else {
                            alert(retorno.msg)
                        }
                    },
                    function (XMLHttpRequest, textStatus, errorThrown) {
                        alert(retorno.msg)
                    });
        }
    }

    function valida_documentos_preliminares(){
        if($('#arquivos_selecionados_data_conclusao_titulacao_doutor tbody').html().trim() === ''){
            alert('Adicione um arquivo em Título que habilita a classe titular');
            return false;
        }
        if($('#arquivos_selecionados_data_termo_avaliacao_desempenho tbody').html().trim() === ''){
            alert('Adicione um arquivo em Termo de avaliaçao de desempenho');
            return false;
        }
        if($('#arquivos_selecionados_data_graduacao_ingresso_ebtt tbody').html().trim() === ''){
            alert('Adicione um arquivo em diploma de graduação para ingresso no cargo de professor de EBTT');
            return false;
        }
        if($('#arquivos_selecionados_Declaracao_DIGPE tbody').html().trim() === ''){
            alert('Adicione um arquivo progressão ou enquadramento no nível D404');
            return false;
        }

        return true;
    }

    function getUnique(inputArray){
        var outputArray = [];
        for (var i = 0; i < inputArray.length; i++) {
            if ((jQuery.inArray(inputArray[i], outputArray)) == -1) {
                outputArray.push(inputArray[i]);
            }
        }
        return outputArray;
    }

    function Valida_datas(acao){
        let rsc_error = [];
        $('input[type=date]').each(function (item) {
            var data = $(this).attr('id');
            if ((acao == "salvar") || (acao == "Autosalvar")) {
                if ((data != 'id_data_conclusao_titulacao_doutor') && (data != 'id_data_graduacao_EBTT') && (data != 'id_data_concessao_titulacao_doutor') && (data != 'id_data_progressaoD404') && (data != 'id_data_avaliacao_desempenho')  )  {
                    if ($("#" + data).val() == '') {
                        $("#" + data).css("border", "red solid 1px");
                        let rsc = $(this).closest('.tab-container').attr('data-tab');
                        rsc = rsc.replace('_',' ');
                        rsc_error.push(rsc);
                    } else {
                        $("#" + data).css("border", "");
                    }
                }
            }else{
                if ($("#" + data).val() == '') {
                    $("#" + data).css("border", "red solid 1px");
                    let rsc = $(this).closest('.tab').attr('data-tab');
                    rsc = rsc.replace('_',' ');
                    rsc_error.push(rsc);
                } else {
                    $("#" + data).css("border", "");
                }
            }
        });
        return rsc_error;
    }

    function Valida_qtds(){
        var rsc_error = [];
        $(".integer-widget").each(function (item) {
            var qtd = $(this).attr('id');
            var data = qtd.replace('qtd','data');
            if ($("#"+qtd).val() == '') {
                $("#"+qtd).css("border", "red solid 1px");
                $("#"+qtd).parents('.box:first').css("border", "red solid 1px");

                $("#"+qtd).parents('.box:first').children('div').show();
                id_box =  $("#"+qtd).parents('.box:first').attr('id');
                $('#'+id_box).attr('class', 'box');
                rsc = $(this).closest('.tab').attr('data-tab');
                rsc_error.push(rsc);
            } else {
                $("#"+qtd).css("border", "");
                if ($("#"+data).val() != '') {
                    $("#"+qtd).parents('.box:first').css("border", "");
                }
            }
        });
        return rsc_error;
    }

    function Valida_descricoes(){
        var rsc_error = [];
        $(".textarea_descricao").each(function (item) {
            var descricao = $(this).attr('id');
            var data = descricao.replace('qtd','descricao');
            if ($("#"+descricao).val() == '') {
                $("#"+descricao).css("border", "red solid 1px");
                $("#"+descricao).parents('.box:first').css("border", "red solid 1px");
                $("#"+descricao).parents('.box:first').children('div').show();
                rsc = $(this).closest('.tab').attr('data-tab');
                rsc_error.push(rsc);
            } else {
                $("#"+descricao).css("border", "");
                if ($("#"+data).val() != ''){
                    $("#"+descricao).parents('.box:first').css("border", "");
                }
            }
        });
        return rsc_error;
    }

    function Salvar_Processo_Titular(processo_id, autoSalvamento){

        $.ajax({
            type: "POST",
            url: '/professor_titular/salvar_processo_titular/'+processo_id+'/',
            data: $('#form_rsc').serialize(),
            success: function (retorno) {
                if (retorno.ok) {
                    if (autoSalvamento == "nao") {//Se não for o autoSalvamento ele mostra a mensagem
                        $('#error').fadeOut();

                        $('#feedback_message').hide();
                        $('#feedback_message').show();
                        $('#feedback_message').html("Alterações salvas com sucesso.");
                        $('#feedback_message').delay(5000).fadeOut(1500);
                    }else {

                        $('#feedback_message').delay(5000).fadeOut(1500);
                        $('#error').delay(5000).fadeOut(1500);
                    }
                    $('#data_referencia_retroatividade').html(retorno.data_referencia_retroatividade);
                    $('#requisitos_minimos_aprovacao').html(retorno.requisitos_minimos_processo);
                }else {
                    //erro no salvamento
                    $('#error').fadeOut();
                    $('#feedback_message').attr('class', 'errornote');
                    $('#feedback_message').fadeOut();
                    $('#feedback_message').fadeIn();
                    $('#feedback_message').html(retorno.msg);
                }
            }
        });
    }

    function Enviar_Processo_Titular(processo_id) {
        if (confirm("Deseja enviar esse processo para avaliação?")) {
            $('#link_enviar_cppd').click();
        }
    }

    function Valida_Pontuacao(pontuacao_minima_exigida){
        var pontuacoes_grupos = {};
        pontuacoes_grupos["A"] = $("#rsc1").html();
        pontuacoes_grupos["B"] = $("#rsc2").html();
        pontuacoes_grupos["C"] = $("#rsc3").html();
        pontuacoes_grupos["D"] = $("#rsc4").html();
        pontuacoes_grupos["E"] = $("#rsc5").html();
        pontuacoes_grupos["F"] = $("#rsc6").html();
        pontuacoes_grupos["G"] = $("#rsc7").html();
        pontuacoes_grupos["H"] = $("#rsc8").html();

        var soma_grupos = 0;
        for(grupo in pontuacoes_grupos){
            pontuacao_grupo = parseFloat(pontuacoes_grupos[grupo]);
            soma_grupos += pontuacao_grupo;
        }
        if (soma_grupos >= pontuacao_minima_exigida){
            return true;
        } else {
            return false;
        }
    }

    function Valida_Quantidade_Grupos(qtd_minima_grupos){
        var pontuacoes_grupos = {};
        pontuacoes_grupos["A"] = $("#rsc1").html();
        pontuacoes_grupos["B"] = $("#rsc2").html();
        pontuacoes_grupos["C"] = $("#rsc3").html();
        pontuacoes_grupos["D"] = $("#rsc4").html();
        pontuacoes_grupos["E"] = $("#rsc5").html();
        pontuacoes_grupos["F"] = $("#rsc6").html();
        pontuacoes_grupos["G"] = $("#rsc7").html();
        pontuacoes_grupos["H"] = $("#rsc8").html();

        var qtd_grupos_pontuando = 0;
        var soma_grupos = 0;
        for(grupo in pontuacoes_grupos){
            pontuacao_grupo = parseFloat(pontuacoes_grupos[grupo]);
            if(pontuacao_grupo != 0){
                qtd_grupos_pontuando += 1;
            }
        }

        if (qtd_grupos_pontuando >= qtd_minima_grupos){
            return true;
        } else {
            return false;
        }
    }

    function Processa_Salvamento(acao, processo_id, rsc_pretendido, status, pontuacao_minima_exigida, qtd_minima_grupos){
        var rsc_error = Valida_qtds();
        rsc_error = rsc_error.concat(Valida_datas(acao));
        rsc_error = rsc_error.concat(Valida_descricoes());
        rsc_error = getUnique(rsc_error.sort());
        var qtd_error

        qtd_error = rsc_error.length;
        //alert(qtd_error);

        if (qtd_error > 0)  {
            $('#feedback_message').fadeOut();
            $('#error').attr('class','errornote');
            $('#error').html('Existe(m) erro(s) na(s) aba(s) ' + rsc_error);
            $('#error').fadeOut();
            $('#error').fadeIn();

        } else {

            if (acao == "salvar") {
                //if(valida_documentos_preliminares()){
                    Salvar_Processo_Titular(processo_id, "nao");
                //}
            } else if (acao == "Autosalvar") {
                if (status != 'Aguardando avaliação CPPD') {
                    Salvar_Processo_Titular(processo_id, "sim");
                }
            } else {
                if (Valida_Pontuacao(pontuacao_minima_exigida)) {
                    if (Valida_Quantidade_Grupos(qtd_minima_grupos)) {
                        Salvar_Processo_Titular(processo_id);

                        var introducao = $('#id_introducao_relatorio_descritivo').val();
                        var consideracoes_finais = $('#id_conclusao_relatorio_descritivo').val();
                        var enviar = false;
                        if (introducao.trim() == "") {
                            alert("Você não preencheu a Introdução do memorial descritivo. Este campo é de preenchimento obrigatório!");
                        } else if (consideracoes_finais.trim() == "") {
                            alert("Você não preencheu a Considerações Finais do memorial descritivo. Este campo é de preenchimento obrigatório!");
                        } else {
                            enviar = true;
                        }
                        if (enviar && valida_documentos_preliminares()) {
                            Enviar_Processo_Titular(processo_id);
                        }
                    } else {
                        alert('Você não atingiu a quantidade mínima de grupos exigidos.');
                    }
                } else {
                    alert('Você não atingiu a pontuação mínima.');
                }
            }
        }
        return false;
    }

    function human_file_size(bytes, si) {
        var thresh = si ? 1000 : 1024;
        if(bytes < thresh) return bytes + ' B';
        var units = si ? ['kB','MB','GB','TB','PB','EB','ZB','YB'] : ['KB','MB','GB','TB','PB','EB','ZB','YB'];
        var u = -1;
        do {
            bytes /= thresh;
            ++u;
        } while(bytes >= thresh);
        return bytes.toFixed(1)+' '+units[u];
    };

    function onCompleteUploadDataTitulacaoDoutor(uploader, id, fileName, responseJSON) {
        var el = uploader._getItemByFileId(id);
        var msn = "Deseja continuar?";
        var url = "/professor_titular/excluir_arquivo_exigido_pdf/" + responseJSON.arquivo_pk_crypto + "/";
        if (responseJSON.success) {
            var templateRow = '' +
                    '<tr id="linha-' + responseJSON.arquivo_pk_crypto + '" class="linha-' + responseJSON.arquivo_pk_crypto + '">' +
                    '   <td>' +
                    '       <a class="icon icon-view" href="/professor_titular/visualizar_arquivo_exigido_pdf/' + responseJSON.arquivo_pk_crypto + '" title="Visualizar o arquivo ' + fileName + '"><span class="sr-only">Visualizar</span></a>' +
                    '       <a class="icon icon-delete" href="javascript:void(0);" onclick="Excluir(\'' + responseJSON.arquivo_pk_crypto + '\', \'' + msn + '\', \'' + url + '\',\'{{ processo.id }}\',true)"><span class="sr-only">Excluir</span></a>' +
                    '   </td>' +
                    '   <td><a href="/professor_titular/visualizar_arquivo_exigido_pdf/' + responseJSON.arquivo_pk_crypto + '" target="_blank" title="Visualizar o arquivo ' + fileName + '">' + fileName + '</a></td>' +
                    '   <td>' + human_file_size(responseJSON.tamanho) + '</td>' +
                    '</tr>';
            $("#arquivos_selecionados_data_conclusao_titulacao_doutor tbody").html(templateRow).fadeIn("slow");
            $($(el).find('.qq-upload-result')[0]).html('<span class="true">Concluído</span>');
            $(el).fadeOut("fast");
        } else {
            $($(el).find('.qq-upload-result')[0]).html('<span class="false">Ocorreu um erro!</span>');
        }
        $(el).find('.qq-progress')[0].remove();
    }

    function onCompleteUploadTermoAvaliacaoDesempenho(uploader, id, fileName, responseJSON) {
        var el = uploader._getItemByFileId(id);
        var msn = "Deseja continuar?";
        var url = "/professor_titular/excluir_arquivo_exigido_pdf/" + responseJSON.arquivo_pk_crypto + "/";
        if (responseJSON.success) {
            var templateRow = '' +
                    '<tr id="linha-' + responseJSON.arquivo_pk_crypto + '" class="linha-' + responseJSON.arquivo_pk_crypto + '">' +
                    '   <td>' +
                    '       <a class="icon icon-view" href="/professor_titular/visualizar_arquivo_exigido_pdf/' + responseJSON.arquivo_pk_crypto + '" title="Visualizar o arquivo ' + fileName + '"><span class="sr-only">Visualizar</span></a>' +
                    '       <a class="icon icon-delete no-confirm" href="javascript:void(0);" onclick="Excluir(\'' + responseJSON.arquivo_pk_crypto + '\', \'' + msn + '\', \'' + url + '\',\'{{ processo.id }}\',true)"><span class="sr-only">Excluir</span></a>' +
                    '   </td>' +
                    '   <td><a href="/professor_titular/visualizar_arquivo_exigido_pdf/' + responseJSON.arquivo_pk_crypto + '" title="Visualizar o arquivo ' + fileName + '" target="_blank">' + fileName + '</a></td>' +
                    '   <td>' + human_file_size(responseJSON.tamanho) + '</td>' +
                    '</tr>';
            $("#arquivos_selecionados_data_termo_avaliacao_desempenho tbody").html(templateRow).fadeIn("slow");
            $($(el).find('.qq-upload-result')[0]).html('<span class="true">Concluído</span>');
            $(el).fadeOut("fast");
        } else {
            $($(el).find('.qq-upload-result')[0]).html('<span class="false">Ocorreu um erro!</span>');
        }
        $(el).find('.qq-progress')[0].remove();
    }

    function onCompleteUploadDataGraduacaoIngressoEBTT(uploader, id, fileName, responseJSON) {
        var el = uploader._getItemByFileId(id);
        var msn = "Deseja continuar?";
        var url = "/professor_titular/excluir_arquivo_exigido_pdf/" + responseJSON.arquivo_pk_crypto + "/";
        if (responseJSON.success) {
            var templateRow = '' +
                    '<tr id="linha-' + responseJSON.arquivo_pk_crypto + '" class="linha-' + responseJSON.arquivo_pk_crypto + '">' +
                    '   <td>' +
                    '       <a class="icon icon-view" href="/professor_titular/visualizar_arquivo_exigido_pdf/' + responseJSON.arquivo_pk_crypto + '" title="Visualizar o arquivo ' + fileName + '"><span class="sr-only">Visualizar</span></a>' +
                    '       <a class="icon icon-delete no-confirm" href="javascript:void(0);" onclick="Excluir(\'' + responseJSON.arquivo_pk_crypto + '\', \'' + msn + '\', \'' + url + '\',\'{{ processo.id }}\',true)"><span class="sr-only">Excluir</span></a>' +
                    '   </td>' +
                    '   <td><a href="/professor_titular/visualizar_arquivo_exigido_pdf/' + responseJSON.arquivo_pk_crypto + '" title="Visualizar o arquivo ' + fileName + '" target="_blank">' + fileName + '</a></td>' +
                    '   <td>' + human_file_size(responseJSON.tamanho) + '</td>' +
                    '</tr>';
            $("#arquivos_selecionados_data_graduacao_ingresso_ebtt tbody").html(templateRow).fadeIn("slow");
            $($(el).find('.qq-upload-result')[0]).html('<span class="true">Concluído</span>');
            $(el).fadeOut("fast");
        } else {
            $($(el).find('.qq-upload-result')[0]).html('<span class="false">Ocorreu um erro!</span>');
        }
        $(el).find('.qq-progress')[0].remove();
    }

	function onCompleteUploadDeclaraçãoDIGPE(uploader, id, fileName, responseJSON) {
        var el = uploader._getItemByFileId(id);
        var msn = "Deseja continuar?";
        var url = "/professor_titular/excluir_arquivo_exigido_pdf/" + responseJSON.arquivo_pk_crypto + "/";
        if (responseJSON.success) {
            var templateRow = '' +
                    '<tr id="linha-' + responseJSON.arquivo_pk_crypto + '" class="linha-' + responseJSON.arquivo_pk_crypto + '">' +
                    '   <td>' +
                    '       <a class="icon icon-view" href="/professor_titular/visualizar_arquivo_exigido_pdf/' + responseJSON.arquivo_pk_crypto + '" title="Visualizar o arquivo ' + fileName + '"><span class="sr-only">Visualizar</span></a>' +
                    '       <a class="icon icon-delete no-confirm" href="javascript:void(0);" onclick="Excluir(\'' + responseJSON.arquivo_pk_crypto + '\', \'' + msn + '\', \'' + url + '\',\'{{ processo.id }}\',true)"><span class="sr-only">Excluir</span></a>' +
                    '   </td>' +
                    '   <td><a href="/professor_titular/visualizar_arquivo_exigido_pdf/' + responseJSON.arquivo_pk_crypto + '" title="Visualizar o arquivo ' + fileName + '" target="_blank">' + fileName + '</a></td>' +
                    '   <td>' + human_file_size(responseJSON.tamanho) + '</td>' +
                    '</tr>';
            $("#arquivos_selecionados_Declaracao_DIGPE tbody").html(templateRow).fadeIn("slow");
            $($(el).find('.qq-upload-result')[0]).html('<span class="true">Concluído</span>');
            $(el).fadeOut("fast");
        } else {
            $($(el).find('.qq-upload-result')[0]).html('<span class="false">Ocorreu um erro!</span>');
        }
        $(el).find('.qq-progress')[0].remove();
    }
    </script>

{% endblock %}

{% block before_holder %}
    <p id="feedback_message" class="msg success fixed" style="display:none"> Processo de RSC salvo com sucesso. </p>
    <p id="error" style="display:none"> Por favor, corrija os erros abaixo. </p>
{% endblock %}

{% block content %}

{#    <p id="feedback_message" class="d-none" style="z-index: 1">Processo salvo com sucesso.</p>#}
{#    <p id="error" class="d-none" style="z-index: 1">Por favor, corrija os erros abaixo.</p>#}

    <a hidden class="popup" id="link_enviar_cppd" href="/professor_titular/enviar_processo_titular/{{ processo.pk }}/"></a>

    <form id="form_rsc" action="" method="post">
    {% csrf_token %}

     {% block action_bar_acoes %}
         <ul class="action-bar">
            <li><a id="recalcular_pontuacao" href="{% url 'recalcular_pontuacao' processo.pk%}" class="btn primary">Recalcular Pontuação</a></li>
        </ul>
     {% endblock %}

    {% if processo.servidor %}
        {% box 'Identificação do Servidor' %}
            <table class="info">
                <tr>
                    <td>Nome</td>
                    <td>{{ processo.servidor.nome }}</td>
                    <td>Matrícula</td>
                    <td colspan="3">{{ processo.servidor.matricula }}</td>
                </tr>
                <tr>
                    <td>E-mail Institucional</td>
                    <td><a href="mailto:{{ processo.servidor.email }}">{{ processo.servidor.email|format }}</a></td>
                    <td>Cargo</td>
                    <td colspan="3">{{ processo.servidor.cargo_emprego }}</td>
                </tr>
                <tr>
                    <td>Requisição de promoção à classe titular</td>
                    <td>{{ title }}</td>
                    <td>Pontuação Requerida</td>
                    <td><span id="pontuacao_requerida">{{ processo.pontuacao_pretendida|format }}</span></td>
                    <td>Data de Retroatividade Requerida</td>
                    <td><span id="data_referencia_retroatividade">{{ processo.get_data_referencia_retroativa|format }}</span></td>
                </tr>
                <tr>
                    <td>Requisitos mínimos para aprovação</td>
                    <td colspan="5">
                        <span id="requisitos_minimos_aprovacao" class="text-nowrap-normal">Você precisa de {{ processo.get_requisitos_minimos_processo.pontuacao_exigida }} pontos em {{ processo.get_requisitos_minimos_processo.qtd_minima_grupos }} grupos.</span>
                    </td>
                </tr>
                <tr>
                    <td>Situação do Processo</td>
                    <td colspan="5" id="status">{{ processo.get_status_display|status }}</td>
                </tr>
                {% if processo.ultima_validacao_processo %}
                    <tr>
                        <td>Descrição da Validação</td>
                        <td colspan="5">
                            {{ processo.ultima_validacao_processo.motivo_rejeicao }}
                        </td>
                    </tr>
                {% endif %}
                {% if processo.clonado and processo.clonearquivoerro_set.exists and processo.status == processo.STATUS_AGUARDANDO_ENVIO_CPPD %}
                    <tr>
                        <td>Problemas na clonagem</td>
                        <td colspan="5">
                            <div class="msg critical" style="margin-bottom: 0px;">
                                <p><strong>Alguns arquivos não foram encontrados ou estão corrompidos. É necessário adicioná-los novamente ao processo.</strong></p>
                                <ul>
                                    {% for e in processo.clonearquivoerro_set.all %}
                                    <li>{{ e.nome_arquivo }}
                                        <br />
                                        <small>{{ e.get_localizacao }}</small>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </td>
                    </tr>
                {% endif %}
            </table>
        {% endbox %}

        {%if processo.ultima_validacao_processo and processo.ultima_validacao_processo.motivo_rejeicao %}
            <div class="msg critical">
                <p><strong>Resumo dos problemas:</strong></p>
                <ul>

                    {% if processo.ultima_validacao_processo.titulacao_status != 1 %}
                    <li>
                        Titulação:
                        {{ processo.ultima_validacao_processo.get_titulacao_status_display|format }}
                    </li>
                    {% endif %}

                    {% if processo.ultima_validacao_processo.graduacao_ebtt_status != 1 %}
                    <li>
                        Graduação para Ingresso no Cargo de Professor de EBTT:
                        {{ processo.ultima_validacao_processo.get_graduacao_ebtt_status_display|format }}
                    </li>
                    {% endif %}

                    {% if processo.ultima_validacao_processo.progressao_status != 1 %}
                    <li>
                        Progressão/Enquadramento para D404:
                        {{ processo.ultima_validacao_processo.get_progressao_status_display|format }}
                    </li>
                    {% endif %}

                    {% if processo.ultima_validacao_processo.avaliacao_desempenho_status != 1 %}
                    <li>
                        Avaliação de Desempenho:
                        {{ processo.ultima_validacao_processo.get_avaliacao_desempenho_status_display|format }}
                    </li>
                    {% endif %}

                    {% if processo.ultima_validacao_processo.formulario_pontuacao_status != 1 %}
                    <li>
                        Problemas na aba A, B, C, D, E, F, G ou H: é necessário verificar os arquivos antes de reenviar para a CPPD.
                    </li>
                    {% endif %}

                    {% if processo.ultima_validacao_processo.relatorio_descritivo_status != 1 %}
                    <li>
                        Problemas no Relatório Descritivo: é necessário preencher os campos corretamente.
                    </li>
                    {% endif %}

                </ul>
            </div>
            {% endif %}

        <div class="tab-container" data-title="Instruções Gerais" data-tab="instrucoes_gerais">
            <ol class="instrucoes_gerais lista-numerada">
                <li>O módulo Titular do SUAP é composto por três partes para preenchimento:
	                <ol>
	                    <li>Documentos preliminares: inserção de documentos que habilitam para o processo de avaliação e fornecem referências para os efeitos da data de retroatividade correspondente. São validados pela CPPD após envio do processo pelo docente. São eles:
		                    <ul>
		                        <li>cópia do termo de avaliação de desempenho para fins de progressão para a Classe Titular, com resultado positivo, expedido pelo órgão de gestão de pessoas da unidade de lotação do docente;</li>
		                        <li>data de conclusão e cópia do diploma de doutorado; e</li>
		                        <li>data da progressão para a Classe D-IV-4 e cópia do documento comprobatório para a carreira de Professor de Ensino Básico, Técnico e Tecnológico (ou Professor de 1º e 2º Graus, para os mais antigos) , expedido pelo órgão de gestão de pessoas da unidade de lotação do docente.</li>
		                    </ul>
						</li>
	                    <li>Pontuação e descrição dos indicadores: inserção de documentos comprobatórios, com respectivas descrição analítica, pontuação e data de referência requeridas. A pontuação e a data de referência requeridas serão validadas pelos avaliadores no momento da análise do processo. A descrição analítica inserida comporá o memorial descritivo.</li>
	                    <li>Memorial descritivo: composição cronológica dos indicadores descritos no item anterior, correlacionados de acordo com o art. 6º da Resolução, com possibilidade de inserção de introdução, considerações finais e acréscimo de informações complementares para cada item.</li>
	                </ol>
                </li>
                <li>TODOS os documentos comprobatórios a serem inseridos no módulo Titular do SUAP (em qualquer uma das partes) devem:
	                <ol>
	                    <li>ser digitalizados e armazenados individualmente em um único arquivo por documento comprobatório (mesmo que tenha várias folhas ou seja composto por mais de um documento; por exemplo, para demonstrar um período em meses, o documento comprobatório pode ser composto por um documento que inicia o período e outro que finalizar e deverão estar no mesmo arquivo. Situação similar acontece para a comprovação de um artigo publicado em periódico com indexação em que se queira registrar o aceite do artigo e demonstrar a indexação do periódico, colocando os dois documentos num único arquivo como documento comprobatório);</li>
	                    <li>ter integridade dos arquivos garantida pelo docente (os arquivos deverão ser conferidos e não conter erros ou folhas faltando, pois não poderão ser substituídos posteriormente); e</li>
	                    <li>ter nomes de arquivos condizentes com o conteúdo (pois serão listados na geração do processo).</li>

	                </ol>
                </li>
                <li>Para cada documento inserido no módulo Titular do SUAP, será necessário que o docente estipule a respectiva data de referência. É importante atentar que a data não é necessariamente aquela de assinatura do documento, mas aquela a que se refere ao indicador para o qual está sendo solicitada a pontuação.</li>
                <li>Cabe ressaltar as seguintes dificuldades enfrentadas pelos avaliadores de outros processos conduzidos pela CPPD em relação à data de referência dos documentos:
	                <ol>
	                    <li>Devem ser consideradas como data de referência de certificados e diplomas:
		                    <ul>
		                        <li>a data de conclusão de cursos de graduação, capacitação, especialização ou aperfeiçoamento; e</li>
		                        <li>a data de homologação da defesa, de cursos de mestrado ou doutorado.</li>
		                    </ul>
	                    </li>
	                    <li>Nos documentos em que não é possível identificar a data completa (dia/mês/ano):
                            <ul>
                                <li>se estiver disponível apenas o ano, deve ser considerada como data de referência o último dia do ano (31/12 do respectivo ano); e</li>
                                <li>se estiver disponível mês e ano, deve ser considerada como data de referência o último dia do respectivo mês.</li>
                            </ul>
                        </li>
	                    <li>Para os indicadores medidos em meses, deve-se considerar como data de referência o último mês a ser pontuado (atentar que, em alguns casos, o documento apresenta uma data posterior à necessária para atingimento da pontuação).</li>
	                    <li>Para os indicadores medidos como participação/realização de atividades, deve-se considerar como data de referência o início da atividade.</li>
	                </ol>
                </li>
                <li>Ao final do cadastro do processo pelo docente no SUAP, deverão ser impressos e organizados, nessa sequência (gerados pelo próprio SUAP):
	                <ol>
	                    <li>a capa do processo</li>
	                    <li>o requerimento de solicitação de promoção à Classe Titular (Anexo I da Resolução) – deve ser assinado;</li>
	                    <li>o formulário de pontuação e data de retroatividade requeridas (Anexo II da Resolução) – deve ser assinado;</li>
	                    <li>o memorial descritivo (alíneas “a” a “o” do art. 6º da Resolução); e</li>
	                    <li>a listagem com os documentos comprobatórios inseridos pelo docente em cada indicador.</li>
	                </ol>
                </li>
                <li>A data de retroatividade requerida será calculada automaticamente pelo SUAP, tendo por base as datas de referência inseridas pelo docente para cada documento anexado e considerando a data mais recente em que são contabilizados pontos para atingimento da pontuação mínima para o exercício (conforme Anexo III da Resolução), a data de obtenção do título de doutorado e a data da progressão para D-IV-4.</li>
            </ol>
        </div>

        <div class="tab-container" data-title="Documentos Preliminares" data-tab="documentos_preliminares">

            {% box 'Diploma de graduação para ingresso no cargo de professor de EBTT' %}

                <fieldset>
                    <div class="form-row">
                        <div class="field-box">
                            <label>Data da Homologação do Diploma:</label>
                            {{ processo_form.data_graduacao_EBTT }}
                            <p class="help">Deve ser considerada como data de referência a data de homologação da defesa da monografia ou a data da emissão do diploma (o que for mais antigo).</p>
                        </div>
                    </div>
                </fieldset>

                {% if ultima_validacao and ultima_validacao.data_graduacao_ebtt_validada %}
                    <p class="msg info">Data validada pela CPPD: <strong>{{ ultima_validacao.data_graduacao_ebtt_validada }}</strong></p>
                {% endif %}

                {% if processo.avaliado_pode_editar and processo.avaliado_pode_ajustar %}
	                <div class="msg alert">
	                    <p>Anexe cópia do certificado ou diploma. Deve ser considerada como data de referência a data de homologação da defesa do doutorado ou a data da emissão do diploma (o que for mais antigo).</p>
	                    <p>Somente serão carregados arquivos com extensão <strong>pdf</strong>.</p>
	                </div>
                {% endif %}

                {% if processo.avaliado_pode_editar and processo.servidor.id == user.get_relacionamento.id %}
                    {% render_form data_graduacao_ingresso_ebtt_form False %}
                {% endif %}

                <table id="arquivos_selecionados_data_graduacao_ingresso_ebtt">
                    <thead>
                        <tr>
                            <th>Arquivo</th>
                            <th>Documento</th>
                            <th>Tamanho</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% if processo_form.arquivo_graduacao_ingresso_ebtt %}
                        <tr id="linha-{{ processo_form.arquivo_graduacao_ingresso_ebtt.encrypted_id }}" class="linha-{{ processo_form.arquivo_graduacao_ingresso_ebtt.encrypted_id }}">
                            <td>
                                {% icon "view" "/professor_titular/visualizar_arquivo_exigido_pdf/{{ processo_form.arquivo_graduacao_ingresso_ebtt.encrypted_id }}" %}
                                {% if processo.avaliado_pode_editar and processo.servidor.id == user.get_relacionamento.id %}
                                    <a class="icon icon-delete no-confirm" href="javascript:void(0);" onclick="Excluir('{{processo_form.arquivo_graduacao_ingresso_ebtt.encrypted_id}}', 'Deseja continuar?', '/professor_titular/excluir_arquivo_exigido_pdf/{{processo_form.arquivo_graduacao_ingresso_ebtt.encrypted_id}}/', '{{ processo.id }}',true)"><span class="sr-only">Remover</span></a>
                                {% endif %}
                            </td>
                            <td>
                                <a href="/professor_titular/visualizar_arquivo_exigido_pdf/{{ processo_form.arquivo_graduacao_ingresso_ebtt.encrypted_id }}">
                                    {{ processo_form.arquivo_graduacao_ingresso_ebtt.nome }}
                                </a>
                            </td>
                            <td>{{ processo_form.arquivo_graduacao_ingresso_ebtt.tamanho|human_file_size }}</td>
                        </tr>
                    {% endif %}
                    </tbody>
                </table>
            {% endbox %}

            {% box 'Título que habilita a classe titular (Doutorado)' %}

                <fieldset>
                    <div class="form-row">
                        <div class="field-box">
                            <label>Data da Titulação:</label>
                            {{ processo_form.data_concessao_titulacao_doutor }}
                            <p class="help">Deve ser considerada como data de referência a data de homologação da defesa do doutorado ou a data da emissão do diploma (o que for mais antigo).</p>
                        </div>
                    </div>
                </fieldset>

                {% if ultima_validacao and ultima_validacao.data_conclusao_titulacao_validada %}
                    <p class="msg info">Data validada pela CPPD: <strong>{{ ultima_validacao.data_conclusao_titulacao_validada }}</strong></p>
                {% endif %}

               	{% if processo.avaliado_pode_editar and processo.avaliado_pode_ajustar %}
	                <div class="msg alert">
	                	<p>Anexe cópia do diploma. Deve ser considerada como data de referência a data de homologação da defesa do doutorado ou a data da emissão do diploma (o que for mais antigo).</p>
	                    <p>Somente serão carregados arquivos com extensão <strong>pdf</strong>.</p>
	                </div>
	            {% endif %}

                {% if processo.avaliado_pode_editar and processo.servidor.id == user.get_relacionamento.id %}
                    {% render_form data_concessao_titulacao_doutor_form False %}
                {% endif %}

                <table id="arquivos_selecionados_data_conclusao_titulacao_doutor">
                    <thead>
                        <tr>
                            <th>Arquivo</th>
                            <th>Documento</th>
                            <th>Tamanho</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% if processo_form.arquivo_conclusao_titulacao_titular_pretendido %}
                        <tr id="linha-{{ processo_form.arquivo_conclusao_titulacao_titular_pretendido.encrypted_id }}" class="linha-{{ processo_form.arquivo_conclusao_titulacao_titular_pretendido.encrypted_id }}">
                            <td>
                                {% icon "view" "/professor_titular/visualizar_arquivo_exigido_pdf/{{processo_form.arquivo_conclusao_titulacao_titular_pretendido.encrypted_id}}" %}
                                {% if processo.avaliado_pode_editar and processo.servidor.id == user.get_relacionamento.id %}
                                    <a class="icon icon-delete no-confirm" href="javascript:void(0);" onclick="Excluir('{{processo_form.arquivo_conclusao_titulacao_titular_pretendido.encrypted_id}}', 'Deseja continuar?', '/professor_titular/excluir_arquivo_exigido_pdf/{{processo_form.arquivo_conclusao_titulacao_titular_pretendido.encrypted_id}}/', '{{ processo.id }}',true)"><span class="sr-only">Remover</span></a>
                                {% endif %}
                            </td>
                            <td>
                                <a href="/professor_titular/visualizar_arquivo_exigido_pdf/{{ processo_form.arquivo_conclusao_titulacao_titular_pretendido.encrypted_id }}" target="_blank">
                                    {{ processo_form.arquivo_conclusao_titulacao_titular_pretendido.nome }}
                                </a>
                            </td>
                            <td>{{ processo_form.arquivo_conclusao_titulacao_titular_pretendido.tamanho|human_file_size }}</td>
                        </tr>
                    {% endif %}
                    </tbody>
                </table>
            {% endbox %}

            {% box 'Progressão ou Enquadramento no nível D-IV-4' %}
                <fieldset>
                    <div class="form-row">
                        <div class="field-box">
                            <label>Data da Progressão / Enquadramento:</label>
                            {{ processo_form.data_progressaoD404 }}
                            <p class="help">Devem ser consideradas como data de referência: a  data de conclusão de cursos de graduação, capacitação, especialização ou aperfeiçoamento; e data de homologação da defesa, de cursos de mestrado ou doutorado.</p>
                        </div>
                    </div>
                </fieldset>

                {% if ultima_validacao and ultima_validacao.data_progressao_validada %}
                    <span class="msg msg">Data validada pela CPPD: <strong>{{ ultima_validacao.data_progressao_validada }}</strong></span>
                {% endif %}

                {% if processo.avaliado_pode_editar and processo.avaliado_pode_ajustar %}
	                <div class="msg alert">
	                    <p>Anexe cópia de declaração do órgão de gestão de pessoas de lotação (docentes com ingresso anterior a 1º/03/2013) ou cópia da portaria de progressão para D-IV-4.</p>
	                    <p>Somente serão carregados arquivos com extensão <strong>pdf</strong>.</p>
	                </div>
                {% endif %}

                {% if processo.avaliado_pode_editar and processo.servidor.id == user.get_relacionamento.id %}
                    {% render_form declaracao_DIGPE_form False %}
                {% endif %}

                <table id="arquivos_selecionados_Declaracao_DIGPE">
                    <thead>
                        <tr>
                            <th>Arquivo</th>
                            <th>Documento</th>
                            <th>Tamanho</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% if processo_form.arquivo_declarao_DIGPE %}
                        <tr id="linha-{{ processo_form.arquivo_declarao_DIGPE.encrypted_id }}" class="linha-{{ processo_form.arquivo_declarao_DIGPE.encrypted_id }}">
                            <td>
                                {% icon "view" "/professor_titular/visualizar_arquivo_exigido_pdf/{{ processo_form.arquivo_declarao_DIGPE.encrypted_id }}" %}
                                {% if processo.avaliado_pode_editar and processo.servidor.id == user.get_relacionamento.id%}
                                    <a class="icon icon-delete no-confirm" href="javascript:void(0);" onclick="Excluir('{{ processo_form.arquivo_declarao_DIGPE.encrypted_id }}', 'Deseja continuar?', '/professor_titular/excluir_arquivo_exigido_pdf/{{processo_form.arquivo_declarao_DIGPE.encrypted_id}}/', '{{ processo.id }}',true)"><span class="sr-only">Remover</span></a></li>
                                {% endif %}
                            </td>
                            <td>
                                <a href="/professor_titular/visualizar_arquivo_exigido_pdf/{{ processo_form.arquivo_declarao_DIGPE.encrypted_id }}">
                                    {{ processo_form.arquivo_declarao_DIGPE.nome }}
                                </a>
                            </td>
                            <td>{{ processo_form.arquivo_declarao_DIGPE.tamanho|human_file_size }}</td>
                        </tr>
                    {% endif %}
                    </tbody>
                </table>
            {% endbox %}

            {% box 'Termo de Avaliação de Desempenho' %}
                <fieldset>
                    <div class="form-row">
                        <div class="field-box">
                            <label>Data de Avaliação de Desempenho:</label>
                            {{ processo_form.data_avaliacao_desempenho }}
                        </div>
                    </div>
                </fieldset>

                {% if ultima_validacao and ultima_validacao.data_avaliacao_desempenho_validada %}
                    <span class="status status-info">Data validada pela CPPD: {{ ultima_validacao.data_avaliacao_desempenho_validada }}</span>
                {% endif %}

                {% if processo.avaliado_pode_editar and processo.avaliado_pode_ajustar %}
	                <div class="msg alert">
	                    <p>Anexe cópia do termo de avaliação de desempenho para fins de progressão para a Classe Titular, com resultado positivo, expedido pelo órgão de gestão de pessoas da unidade de lotação.</p>
	                    <p>Somente serão carregados arquivos com extensão <strong>pdf</strong>.</p>
	                </div>
                {% endif %}

                {% if processo.avaliado_pode_editar and processo.servidor.id == user.get_relacionamento.id %}
                    {% render_form termo_avaliacao_desempenho_form False %}
                {% endif %}

                <table id="arquivos_selecionados_data_termo_avaliacao_desempenho">
                    <thead>
                        <tr>
                            <th>Arquivo</th>
                            <th>Documento</th>
                            <th>Tamanho</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% if processo_form.arquivo_termo_avaliacao_desempenho %}
                        <tr id="linha-{{ processo_form.arquivo_termo_avaliacao_desempenho.encrypted_id }}" class="linha-{{ processo_form.arquivo_termo_avaliacao_desempenho.encrypted_id }}">
                            <td>
                                {% icon "view" "/professor_titular/visualizar_arquivo_exigido_pdf/{{ processo_form.arquivo_termo_avaliacao_desempenho.encrypted_id }}" %}
                                {% if processo.avaliado_pode_editar and processo.servidor.id == user.get_relacionamento.id %}
                                    <a class="icon icon-delete no-confirm" href="javascript:void(0);" onclick="Excluir('{{ processo_form.arquivo_termo_avaliacao_desempenho.encrypted_id }}', 'Deseja continuar?', '/professor_titular/excluir_arquivo_exigido_pdf/{{processo_form.arquivo_termo_avaliacao_desempenho.encrypted_id}}/','{{ processo.id }}',true)"><span class="sr-only">Remover</span></a>
                                {% endif %}
                            </td>
                            <td>
                                <a href="/professor_titular/visualizar_arquivo_exigido_pdf/{{ processo_form.arquivo_termo_avaliacao_desempenho.encrypted_id }}" target="_blank">
                                    {{ processo_form.arquivo_termo_avaliacao_desempenho.nome }}
                                </a>
                            </td>
                            <td>{{ processo_form.arquivo_termo_avaliacao_desempenho.tamanho }}</td>
                        </tr>
                    {% endif %}
                    </tbody>
                </table>
            {% endbox %}
        </div>

        {% for grupo in grupos %}
            <div class="tab-container" id="tab{{ forloop.counter }}" data-title="{{ grupo.nome }}
                <span id='rsc{{ forloop.counter }}'>
               {% if forloop.counter == 1 %}
                {{ processo.get_pontuacao_pretendida_grupo_A|format }}
                {% elif forloop.counter  == 2 %}
                 {{ processo.get_pontuacao_pretendida_grupo_B|format }}
                {% elif forloop.counter  == 3 %}
                 {{ processo.get_pontuacao_pretendida_grupo_C|format }}
                {% elif forloop.counter  == 4 %}
                 {{ processo.get_pontuacao_pretendida_grupo_D|format }}
                {% elif forloop.counter  == 5 %}
                 {{ processo.get_pontuacao_pretendida_grupo_E|format }}
                {% elif forloop.counter  == 6 %}
                 {{ processo.get_pontuacao_pretendida_grupo_F|format }}
                {% elif forloop.counter  == 7 %}
                 {{ processo.get_pontuacao_pretendida_grupo_G|format }}
                 {% else %}
                 {{ processo.get_pontuacao_pretendida_grupo_H|format }}
                {% endif %}
                </span>" data-tab="{{ grupo.nome }}">

                <input type="hidden" id='rsc{{ forloop.counter }}hidden' name='rsc{{ forloop.counter }}' value='{% if forloop.counter == 1 %}
                {{ processo.get_pontuacao_pretendida_grupo_A }}
                {% elif forloop.counter  == 2 %}
                 {{ processo.get_pontuacao_pretendida_grupo_B }}
                {% elif forloop.counter  == 3 %}
                 {{ processo.get_pontuacao_pretendida_grupo_C }}
                {% elif forloop.counter  == 4 %}
                 {{ processo.get_pontuacao_pretendida_grupo_D }}
                {% elif forloop.counter  == 5 %}
                 {{ processo.get_pontuacao_pretendida_grupo_E }}
                {% elif forloop.counter  == 6 %}
                 {{ processo.get_pontuacao_pretendida_grupo_F }}
                {% elif forloop.counter  == 7 %}
                 {{ processo.get_pontuacao_pretendida_grupo_G }}
                 {% else %}
                 {{ processo.get_pontuacao_pretendida_grupo_H }}
                {% endif %}'>

                {% for indicador in grupo.indicadores %}
                    {% box "{{ indicador.nome }}: {{ indicador.descricao }}" "" "{{indicador.id}}" %}
                        <dl>
                            <dt>
                                Total: <span class="{{ grupo.nome }} total_indicador" id="total_indicador_{{ indicador.id }}">{{ indicador.total_ponto }}</span>
                            </dt>
                        </dl>
                        {% if indicador.criterio_set.all %}
                            {% for criterio in indicador.criterios %}
                                {% box "{{ criterio.artigo }} - {{ criterio.nome }} - [Pontos: <span id='total_pontos_criterio_{{ criterio.id }}'>{{ criterio.total_ponto }}</span>]" "collapsed" "{{ criterio.id }}" %}
                                    <p class="msg alert">Permitido apenas arquivos com extensão <strong>pdf</strong>.</p>

                                    {% if processo.avaliado_pode_editar and processo.servidor.id == user.get_relacionamento.id %}
                                        {% render_file_field processo criterio %}
                                        <script>
                                            function onCompleteUploadCriterio{{ criterio.id }}(uploader, id, fileName, responseJSON) {
                                                var el = uploader._getItemByFileId(id);

                                                var msn = "Deseja continuar?";
                                                var url = "/professor_titular/excluir_arquivo_pdf/" + responseJSON.arquivo_pk_crypto + "/";

                                                if(responseJSON.success) {
                                                    $("#arquivos_selecionados{{ criterio.id }}").removeClass('d-none');
                                                    hash_arquivo = "arquivo-"+ responseJSON.arquivo_pk_crypto;
                                                    var templateRow =
                                                            '<tr id="linha-arquivo-'+responseJSON.arquivo_pk_crypto+'" class="linha-arquivo-'+responseJSON.arquivo_pk_crypto+'">' +
                                                            '    <td rowspan="3">' +
                                                            '         <a class="icon icon-view" href="/professor_titular/visualizar_arquivo_pdf/'+responseJSON.arquivo_pk_crypto+'" title="Visualizar o arquivo '+fileName+'"><span class="sr-only">Visualizar</span></a>' +
                                                            '         <a class="icon icon-delete" href="javascript:void(0);" onclick="Excluir(\''+hash_arquivo+'\', \''+msn+'\', \''+url+'\',\'{{ processo.id }}\')"><span class="sr-only">Remover</span></a>' +
                                                            '    </td>' +
                                                            '     <td rowspan="3">' +
                                                            '         <a href="/professor_titular/visualizar_arquivo_pdf/'+responseJSON.arquivo_pk_crypto+'" title="Visualizar o arquivo '+fileName+'">'+fileName+'</a>' +
                                                            '        ' + human_file_size(responseJSON.tamanho) +
                                                            '     </td>' +
                                                            '     <td>' +
                                                            '         Quantidade: ({{ criterio.unidade }}): '+responseJSON.field_qtd +
                                                            '     </td>' +
                                                            '     <td rowspan="3">'+
                                                            '         '+ responseJSON.field_nota +
                                                            '         <span class="indicador_class_{{ criterio.indicador.id }} criterio_class_{{criterio.id}} {{ criterio.indicador.grupo.nome }}" id="pontuacao_arquivo_'+responseJSON.arquivo_pk+'">0.0</span>' +
                                                            '     </td>' +
                                                            '</tr>' +
                                                            '<tr class="linha-arquivo-'+responseJSON.arquivo_pk_crypto+'">' +
                                                            '     <td>' +
                                                            '        Data de referência : '+responseJSON.field_data +
                                                            '     </td>' +
                                                            '</tr>' +
                                                            '<tr class="linha-arquivo-'+responseJSON.arquivo_pk_crypto+'">' +
                                                            '     <td>' +
                                                            '         Descriçao: '+responseJSON.field_descricao+
                                                            '     </td>' +
                                                            '</tr>';

                                                    $(templateRow).prependTo("#arquivos_selecionados{{ criterio.id }} tbody").fadeIn("slow");
                                                    $($(el).find('.qq-upload-result')[0]).html('<span class="true">Concluído</span>');
                                                    $(el).fadeOut("fast");

                                                    // Adicionar a mascara dinamicamente
                                                    $("input.br-data-widget").unmask();
                                                    $("input.br-data-widget").mask("99/99/9999", {placeholder:" "});
                                                } else {
                                                    $($(el).find('.qq-upload-result')[0]).html('<span class="false">Ocorreu um erro!</span>');
                                                }
                                                $(el).find('.qq-progress')[0].remove();
                                            }
                                        </script>
                                    {% endif %}

                                    <table id="arquivos_selecionados{{ criterio.id }}" {% if not criterio.arquivo_set.all.count %}class="d-none"{% endif %}>
                                        <thead>
                                            <tr>
                                            <th>Arquivo</th>
                                            <th>Documento</th>
                                            <th>Informações</th>
                                            <th>Pontuação</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        {% for arquivo in criterio.arquivo_set.all %}
                                            {% if arquivo.processo.pk == processo.pk %}
                                                <tr id="linha-arquivo-{{ arquivo.encrypted_pk }}" class="linha-arquivo-{{ arquivo.encrypted_pk }}">
                                                    <td rowspan="3">
                                                        {% icon "view" "/professor_titular/visualizar_arquivo_pdf/{{ arquivo.encrypted_pk }}" %}
                                                        {% if processo.avaliado_pode_editar  and processo.servidor.id == user.get_relacionamento.id %}
                                                            <a class="icon icon-delete no-confirm" onclick="Excluir('arquivo-{{ arquivo.encrypted_pk }}', 'Deseja continuar?', '/professor_titular/excluir_arquivo_pdf/{{ arquivo.encrypted_pk }}/', '{{ processo.id }}')" href="javascript:void(0);" title="Excluir o arquivo {{ arquivo.nome }}"><span class="sr-only">Remover</span></a>
                                                        {% endif %}
                                                    </td>

                                                    <td rowspan="3">
                                                        <a href="/professor_titular/visualizar_arquivo_pdf/{{ arquivo.encrypted_pk }}" title="Visualizar o arquivo {{ arquivo.nome }}" target="_blank">{{ arquivo.nome }}</a>
                                                        {{ arquivo.tamanho|human_file_size }}
                                                    </td>

                                                    <td>
                                                        Quantidade ({{ criterio.unidade }}): {{ arquivo|render_qtd_itens }}
                                                    </td>

                                                    <td rowspan="3">
                                                        {{ arquivo|render_nota_pretendida }}
                                                        <span class="indicador_class_{{ criterio.indicador.id }} criterio_class_{{criterio.id}} {{ criterio.indicador.grupo.nome }}" id='pontuacao_arquivo_{{ arquivo.id }}'>{{ arquivo.nota_pretendida }}</span>
                                                    </td>
                                                </tr>
                                                <tr class="linha-arquivo-{{ arquivo.encrypted_pk }}">
                                                    <td>
                                                        Data de referência : {{ arquivo|render_data_referencia }}
                                                    </td>
                                                </tr>
                                                <tr class="linha-arquivo-{{ arquivo.encrypted_pk }}">
                                                    <td>
                                                        <div>Descriçao:</div> {{ arquivo|render_descricao }}
                                                    </td>
                                                </tr>
                                            {% endif %}
                                        {% endfor %}
                                        <tr>
                                        </tbody>
                                    </table>
                                {% endbox %}
                            {% endfor %}
                        {% endif %}
                    {% endbox %}
                {% endfor %}
            </div>
        {% endfor %}

        <div class="tab-container" data-title="Memorial Descritivo" data-tab="relatorio_descritivo"></div>

        <div class="tab-container" data-title="Quadro Resumo da Pontuação Requerida" data-tab="quadro_resumo_pontuacao_requerida"></div>

        {% if processo.avaliado_pode_editar or processo.avaliado_pode_ajustar and processo.servidor.id == user.get_relacionamento.id %}
            <a href="javascript:void(0);" onclick="Processa_Salvamento('enviar_cppd', '{{ processo.id }}', '{{ processo.grupo }}', '', '{{ pontuacao_minima_exigida }}', '{{ qtd_minima_grupos }}')" class="btn success" name="enviar_processo">Enviar para CPPD</a>
            <a href="javascript:void(0);" onclick="Processa_Salvamento('salvar', '{{ processo.id }}', '{{ processo.grupo }}')" class="btn success">Salvar</a>
        {% endif %}

    {% endif %}
    </form>
{% endblock %}
